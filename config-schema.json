{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/anthony-spruyt/json-config-sync/config-schema.json",
  "title": "json-config-sync Configuration",
  "description": "Configuration file for json-config-sync CLI tool that syncs JSON/YAML config files across multiple Git repositories",
  "type": "object",
  "required": ["files", "repos"],
  "properties": {
    "files": {
      "type": "object",
      "description": "Map of target filenames to their configurations. Each file is synced to all repos by default.",
      "minProperties": 1,
      "additionalProperties": {
        "$ref": "#/definitions/fileConfig"
      }
    },
    "repos": {
      "type": "array",
      "description": "List of repository configurations",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/repo"
      }
    }
  },
  "definitions": {
    "fileConfig": {
      "type": "object",
      "description": "Configuration for a single file to sync",
      "required": ["content"],
      "properties": {
        "content": {
          "type": "object",
          "description": "Base configuration content. Supports environment variables: ${VAR}, ${VAR:-default}, ${VAR:?message}",
          "additionalProperties": true
        },
        "mergeStrategy": {
          "type": "string",
          "enum": ["replace", "append", "prepend"],
          "default": "replace",
          "description": "Array merge strategy for this file. 'replace' replaces arrays, 'append' adds overlay after base, 'prepend' adds overlay before base. Default: replace"
        },
        "createOnly": {
          "type": "boolean",
          "default": false,
          "description": "If true, only create this file if it doesn't already exist in the target repo. Useful for files like .trivyignore or .prettierignore where you want to provide defaults but let repos customize. Default: false"
        }
      }
    },
    "repo": {
      "type": "object",
      "description": "Repository configuration",
      "required": ["git"],
      "properties": {
        "git": {
          "oneOf": [
            {
              "type": "string",
              "description": "Single Git repository URL"
            },
            {
              "type": "array",
              "description": "Multiple Git repository URLs (each becomes a separate sync target)",
              "items": {
                "type": "string"
              },
              "minItems": 1
            }
          ],
          "description": "Git repository URL(s). Supports GitHub (git@github.com:owner/repo.git, https://github.com/owner/repo.git) and Azure DevOps formats"
        },
        "files": {
          "type": "object",
          "description": "Per-repo file overrides or exclusions. Keys must reference files defined in the root 'files' object. Set to false to exclude a file from this repo.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "boolean",
                "const": false,
                "description": "Set to false to exclude this file from this repo"
              },
              {
                "$ref": "#/definitions/repoFileOverride"
              }
            ]
          }
        }
      }
    },
    "repoFileOverride": {
      "type": "object",
      "description": "Per-repo override for a specific file",
      "properties": {
        "content": {
          "type": "object",
          "description": "Content overlay merged onto the file's base content. Use $arrayMerge directive to control array merging.",
          "additionalProperties": true
        },
        "override": {
          "type": "boolean",
          "default": false,
          "description": "If true, use only this content and skip merging with base. Requires 'content' to be specified. Default: false"
        },
        "createOnly": {
          "type": "boolean",
          "description": "Override the root-level createOnly setting for this specific repo"
        }
      }
    }
  }
}
